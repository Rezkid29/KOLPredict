# KOL Scraper & Market Generator - TypeScript Edition

A comprehensive TypeScript application that scrapes KOL (Key Opinion Leader) data from kolscan.io and generates prediction markets with X API integration.

## Features

- 🕷️ **Puppeteer Web Scraping** - Stealth browser automation for reliable data extraction
- 🏆 **Rank 1 Detection** - Proper handling of trophy emoji for top KOL
- 📊 **Complete Data Extraction** - Rank, Username, X Handle, Wins/Losses, SOL Gain, USD Gain
- 🐦 **X API Integration** - Follower count fetching with smart caching
- 🎯 **Prediction Markets** - Multiple market types (rank flippening, follower growth, profit streaks)
- 📈 **Rate Limit Compliance** - Respects X API free tier limits (3 lookups/15min)
- 💾 **Smart Caching** - 24-hour follower count caching to minimize API calls

## Setup

### 1. Install Dependencies
```bash
npm install
```

### 2. X API Credentials (Optional but Recommended)
Create a `.env` file in the project root:

```env
X_API_KEY=your_api_key_here
X_API_SECRET=your_api_secret_here
X_ACCESS_TOKEN=your_access_token_here
X_ACCESS_TOKEN_SECRET=your_access_token_secret_here
```

Get these from: https://developer.twitter.com/en/portal/dashboard

### 3. Build the Project
```bash
npm run build
```

## Usage

### Full Pipeline (Scrape + Generate Markets)
```bash
npm run pipeline
# or
npm run dev
```

### Scrape Only
```bash
npm run scrape
```

### Generate Markets Only (requires existing CSV)
```bash
npm run markets
```

## Output Files

- `kol_leaderboard_YYYY-MM-DD_HH-MM-SS.csv` - Scraped KOL data
- `kol_follower_cache.json` - Cached follower counts (24h validity)
- `market_cache_[id].json` - Market data for resolution

## Market Types

1. **Rank Flippening** - Will KOL A rank higher than KOL B tomorrow?
2. **Profit Streak** - Will KOL have positive USD gain tomorrow?
3. **Follower Growth** - Will KOL gain X followers in Y days? *(requires X API)*

## Rate Limits

- **X API Free Tier**: 3 user lookups per 15 minutes
- **Smart Caching**: 24-hour cache reduces API calls by ~95%
- **Graceful Degradation**: Works without X API credentials

## Architecture

```
src/
├── scraper.ts          # Puppeteer-based leaderboard scraper
├── marketGenerator.ts  # Prediction market creation with X API
└── index.ts           # Main orchestration

dist/                  # Compiled JavaScript
data/                  # Cache files and market data
```

## Technical Details

- **TypeScript**: Modern ES2020 with proper type safety
- **Puppeteer**: Headless Chrome for reliable scraping
- **X API v2**: Modern Twitter API with rate limit handling
- **CSV Output**: Properly formatted with all required fields
- **Error Handling**: Robust error handling and graceful degradation
